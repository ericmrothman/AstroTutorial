---
import type { CollectionEntry } from 'astro:content'
import FormattedDate from '../components/FormattedDate.astro'
import type { MarkdownHeading, ImageMetadata } from 'astro'
import TableOfContents from '../components/TableOfContents.astro'
import dayjs from 'dayjs'
import utc from 'dayjs/plugin/utc'
import { BUNNY_EMBED_URL } from '../consts'
import BaseLayout from './BaseLayout.astro'
import { Image } from 'astro:assets'
import { Icon } from 'astro-icon/components'

dayjs.extend(utc)

type Props = CollectionEntry<'work'>['data'] & {
	headings: MarkdownHeading[]
	slug: string
	remarkPluginFrontmatter: Record<string, string>
}

const {
	title,
	description,
	year,
	role,
	collaborators,
	tags,
	headings,
	slug,
	remarkPluginFrontmatter,
	bunnyVideoId,
} = Astro.props

const videoEmbedUrl = bunnyVideoId ? `${BUNNY_EMBED_URL}/${bunnyVideoId}` : null
---

<BaseLayout title={title} description={description}>
	<main>
		<article>
			<div
				class="app-container flex flex-col lg:flex-row-reverse justify-between gap-8 py-40 relative"
			>
				<div class="md:w-1/4 relative"></div>

				<!-- VIDEO EMBED -->
				<div class="grow w-full md:max-w-[75ch]">
					{
						videoEmbedUrl && (
							<div class="relative w-full aspect-video bg-black rounded-xl overflow-hidden mb-8 shadow-xl">
								<iframe
									src={`${videoEmbedUrl}?autoplay=false&loop=false&muted=false&preload=true`}
									loading="lazy"
									class="absolute top-0 left-0 w-full h-full border-0"
									allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
									allowfullscreen="true"
								/>
							</div>
						)
					}

					<!-- ROLE, COLLABORATORS, YEAR SECTION -->
					<div>
						<h1 class="text-4xl sm:text-5xl leading-snug pt-0 font-bold">
							{title}
						</h1>

						<div
							class="grid grid-cols-2 md:grid-cols-3 gap-6 py-8 my-8 border-y border-neutral-200 dark:border-neutral-800 text-sm"
						>
							{
								role && (
									<div class="flex flex-col gap-1">
										<span class="text-neutral-500 uppercase tracking-wider text-xs font-bold">
											Role
										</span>
										<span class="font-medium">{role}</span>
									</div>
								)
							}
							{
								collaborators && (
									<div class="flex flex-col gap-1 col-span-2 md:col-span-1">
										<span class="text-neutral-500 uppercase tracking-wider text-xs font-bold">
											Collaborators
										</span>
										<span class="font-medium">
											{Array.isArray(collaborators)
												? collaborators.join(', ')
												: collaborators}
										</span>
									</div>
								)
							}
							{
								year && (
									<div class="flex flex-col gap-1">
										<span class="text-neutral-500 uppercase tracking-wider text-xs font-bold">
											Year
										</span>
										<span class="font-medium">
											{dayjs(year).format('YYYY')}
										</span>
									</div>
								)
							}
						</div>

						<!-- MARKDOWN GETS POPULATED HERE -->
						<div
							class="prose prose-neutral prose-lg md:prose-xl dark:prose-invert prose-img:rounded-xl prose-figure:text-center prose-img:mx-auto"
						>
							<slot />
						</div>
					</div>
				</div>
			</div>
		</article>
	</main>
</BaseLayout>
